name: ðŸš€ GÃ©nÃ©ration VidÃ©o AutomatisÃ©e

on:
  workflow_dispatch:
  schedule:
    - cron: "0 6 * * *"

jobs:
  generate-video:
    runs-on: ubuntu-latest
    
    steps:
      - name: ðŸ“¥ Checkout du code
        uses: actions/checkout@v4

      - name: ðŸ Configuration Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.10"

      - name: ðŸ”§ Installation des dÃ©pendances Python
        run: |
          python -m pip install --upgrade pip
          if [ -f requirements.txt ]; then
            pip install -r requirements.txt
          else
            echo "ðŸ“¦ Installation des dÃ©pendances de base..."
            pip install pillow numpy requests
          fi

      - name: ðŸ“ CrÃ©ation de l'arborescence
        run: |
          mkdir -p output/videos output/audio output/images output/logs content_factory
          echo "âœ… Structure de dossiers crÃ©Ã©e"

      - name: ðŸ–¼ï¸ VÃ©rification ImageManager
        run: |
          echo "ðŸ” VÃ©rification du module ImageManager..."
          
          # CrÃ©er le fichier s'il n'existe pas
          if [ ! -f "content_factory/image_manager.py" ]; then
            echo "ðŸ“ CrÃ©ation du fichier image_manager.py..."
            cat > content_factory/image_manager.py << 'PYEOF'
class ImageManager:
    """
    Gestionnaire d'images pour la gÃ©nÃ©ration de contenu vidÃ©o
    """
    
    def __init__(self):
        """Initialise le gestionnaire d'images"""
        import os
        self.image_dir = "output/images"
        os.makedirs(self.image_dir, exist_ok=True)
        print(f"ðŸ“ Dossier images: {self.image_dir}")
    
    def get_images_for_content(self, content_data, num_images=3):
        """
        GÃ©nÃ¨re des images pour le contenu
        """
        import os
        print(f"ðŸ–¼ï¸ GÃ©nÃ©ration de {num_images} images...")
        images = []
        
        try:
            from PIL import Image, ImageDraw
            
            for i in range(num_images):
                img_path = os.path.join(self.image_dir, f"image_{i+1:02d}.jpg")
                
                # CrÃ©er une image avec couleur variÃ©e
                couleur_r = (i * 60) % 255
                couleur_g = 100
                couleur_b = 150
                
                img = Image.new('RGB', (800, 600), color=(couleur_r, couleur_g, couleur_b))
                draw = ImageDraw.Draw(img)
                
                # Ajouter un texte simple
                draw.text((50, 50), f"Image {i+1}", fill=(255, 255, 255))
                
                img.save(img_path, quality=85)
                images.append(img_path)
                print(f"  âœ… Image {i+1} gÃ©nÃ©rÃ©e")
            
        except ImportError:
            print("âš ï¸ PIL non disponible, crÃ©ation de fichiers texte...")
            for i in range(num_images):
                img_path = os.path.join(self.image_dir, f"image_{i+1:02d}.txt")
                with open(img_path, 'w') as f:
                    f.write(f"Placeholder image {i+1}")
                images.append(img_path)
        
        print(f"âœ… {len(images)} images gÃ©nÃ©rÃ©es")
        return images
PYEOF
            echo "âœ… Fichier image_manager.py crÃ©Ã©"
          else
            echo "âœ… Fichier image_manager.py existe dÃ©jÃ "
          fi

      - name: ðŸ§ª Test d'ImageManager
        run: |
          echo "ðŸ§ª Test de la classe ImageManager..."
          python3 -c "
from content_factory.image_manager import ImageManager
manager = ImageManager()
images = manager.get_images_for_content({'titre': 'Test'}, 2)
print(f'ðŸŽ‰ Test rÃ©ussi! {len(images)} images crÃ©Ã©es')
"

      - name: ðŸ’¾ Sauvegarde des rÃ©sultats
        uses: actions/upload-artifact@v4
        with:
          name: contenus-generees
          path: output/
          retention-days: 1
