name: Daily Auto Content Factory
on:
  schedule:
    - cron: '0 8,12,16,20 * * *'
  workflow_dispatch:

jobs:
  content-production:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
          
      - name: Install system dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y ffmpeg python3-pip
          
      - name: Cache pip packages
        uses: actions/cache@v3
        with:
          path: ~/.cache/pip
          key: ${{ runner.os }}-pip-${{ hashFiles('requirements.txt') }}
          restore-keys: |
            ${{ runner.os }}-pip-
            
      - name: Install Python dependencies
        run: |
          pip install -r requirements.txt
          
      - name: Run Auto Factory
        env:
          YOUTUBE_CLIENT_SECRET_1: ${{ secrets.YOUTUBE_CLIENT_SECRET_1 }}
          YOUTUBE_REFRESH_TOKEN_1: ${{ secrets.YOUTUBE_REFRESH_TOKEN_1 }}
          YOUTUBE_CHANNEL_ID_1: ${{ secrets.YOUTUBE_CHANNEL_ID_1 }}
        run: python content_factory/auto_content_engine.py

      - name: Upload video artifact
        if: always()  # ← Même en cas d'erreur, on récupère la vidéo
        uses: actions/upload-artifact@v3
        with:
          name: generated-video
          path: output/
          retention-days: 1  # ← Garde 1 jour pour économiser l'espace
